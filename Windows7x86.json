{
    "builders": [
    {
        "type": "virtualbox-iso",
        "guest_os_type": "{{user `vbox_guestos`}}",
        "iso_url": "{{user `iso_url`}}",
        "iso_checksum": "{{user `iso_checksum`}}",
        "iso_checksum_type": "{{user `iso_checksum_type`}}",
        "vboxmanage": [
            [
            "modifyvm",
            "{{.Name}}",
            "--memory",
            "2048"
            ],
            [
            "modifyvm",
            "{{.Name}}",
            "--vram",
            "48"
            ],
            [
            "modifyvm",
            "{{.Name}}",
            "--cpus",
            "2"
            ]
        ],
        "output_directory": "./output-{{user `vm_name`}}",
        "vm_name": "{{user `vm_name`}}",
        "guest_additions_mode": "attach",
        "headless": "{{user `headless` }}",
        "communicator": "winrm",
        "winrm_username": "vagrant",
        "winrm_password": "vagrant",
        "winrm_timeout": "12h",
        "shutdown_command": "{{user `shutdown_command`}}",
        "shutdown_timeout": "{{user `shutdown_timeout`}}",
        "floppy_files": [
            "VMTools\\virtualbox\\VMTools.ps1",
            "AnswerFiles\\{{user `vm_name`}}\\Autounattend.xml",
            "AnswerFiles\\syspre{{user `arch`}}\\postunattend.xml",
            "Scripts\\T00.ps1",
            "Scripts\\setupcomplete.cmd",
            "scripts\\zero.ps1"
        
        ]
    }
    ],
    "provisioners": [
        {
            "type": "powershell",
            "inline": "&c:\\vmtools.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "1h"
        },
        {
            "type": "powershell",
            "script": "scripts/SPInstall.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [0, 3010]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/Fix-Updates.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/T01-InitialUpdates.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/T02-InstallUpdates.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/T02-InstallUpdates.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/T02-InstallUpdates.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "2h"
        },
        {
            "type": "powershell",
            "script": "scripts/T03-InstallWMF5.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ],
            "valid_exit_codes": [
                0,
                1,
                2,
                3,
                5,
                10,
                15,
                3010
            ]
        },
        {
            "type": "windows-restart",
            "restart_timeout": "1h"
        },
        {
            "type": "powershell",
            "script": "scripts/T04-Finish.ps1",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "environment_vars": [
                "guestos={{user `vm_name`}}",
                "debugbuild={{user `debugbuild`}}"
            ]
        }
    ],
    "post-processors" : [
        {
            "type" : "vagrant",
            "keep_input_artifact": false,
            "output": "{{user `vm_name`}}-wmf5-nocm-{{.Provider}}.box",
            "vagrantfile_template": "vagrantfile.template"
        }
    ],
    "variables": {
        "iso_url": "http://care.dlservice.microsoft.com/dl/download/evalx/win7/x86/EN/7600.16385.090713-1255_x86fre_enterprise_en-us_EVAL_Eval_Enterprise-GRMCENEVAL_EN_DVD.iso",
        "iso_checksum": "971fc00183a52c152fe924a6b99fdec011a871c2",
        "iso_checksum_type": "sha1",
        "vbox_guestos": "Windows7",
        "vm_name": "Windows 7 x86",
        "headless": "true",
        "shutdown_command": "shutdown.exe /s /t 0 /f",
        "shutdown_timeout": "1h",
        "arch": "x86",
        "debugbuild": "false"
         }
}



